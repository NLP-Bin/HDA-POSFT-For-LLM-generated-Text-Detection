# LLaMA-3.1-8B-Instruct å¾®è°ƒä¸æ¨ç†æµç¨‹è¯´æ˜

æœ¬é¡¹ç›®æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„åŸºäº [LLaMA-3.1-8B-Instruct](https://huggingface.co/) æ¨¡å‹çš„å¾®è°ƒä¸æ¨ç†æµç¨‹ï¼Œæ¶µç›–æ•°æ®é¢„å¤„ç†ã€SFT è®­ç»ƒã€DPO è®­ç»ƒä»¥åŠæ¨¡å‹é¢„æµ‹è¿‡ç¨‹ã€‚

ä»»åŠ¡ä¸ºï¼šNLPCC2025 å…±äº«ä»»åŠ¡ 1: å¤§å‹è¯­è¨€æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ£€æµ‹

---

## ğŸ›  å‡†å¤‡å·¥ä½œ

### 1. æ¨¡å‹å‡†å¤‡

è¯·å…ˆä¸‹è½½å¹¶è§£å‹ `LLaMA-3.1-8B-Instruct` æ¨¡å‹æƒé‡æ–‡ä»¶ï¼Œå¹¶å°†è·¯å¾„é…ç½®åˆ°ä»¥ä¸‹ä¸¤ä¸ªè„šæœ¬ä¸­ï¼š

- `run_llama.sh`
- `run_test_llama.sh`

ä¿®æ”¹å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

```bash
--model_name_or_path /your/local/path/to/LLaMA-3.1-8B-Instruct
```
### 2.ç¯å¢ƒé…ç½®
>æ³¨æ„`main.py`ä¸­ï¼Œéœ€è¦å°†`WANDB_API_KEY`æ›¿æ¢ä¸ºä¸ªäººç”¨æˆ·å®é™…å€¼

ç¡®ä¿ä½¿ç”¨ Python 3.10ï¼Œå¹¶æ ¹æ® requirements.txt å®‰è£…æ‰€éœ€ä¾èµ–ï¼š
```bash
conda create -n llama_env python=3.10
conda activate llama_env
pip install -r requirements.txt
```
ğŸš€ ä½¿ç”¨æ­¥éª¤
### ç¬¬ä¸€æ­¥ï¼šæ•°æ®é¢„å¤„ç†
è¿è¡Œæ•°æ®å¤„ç†è„šæœ¬ï¼š

```bash
bash run_data_process.sh
```
è¯¥è„šæœ¬ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

æ•°æ®å¢å¼ºï¼šaugment.py ä¼šå¯¹åŸå§‹æ•°æ®è¿›è¡Œå¢å¼ºï¼Œè½¬æ¢åçš„æ•°æ®å°†ä¿å­˜åœ¨ ./data/augmented_data/augmented_train.json ä¸­ã€‚

æ ¼å¼è½¬æ¢ï¼štransfer.py å°†æ•°æ®è½¬æ¢ä¸ºä»¥ä¸‹ä¸¤ç§è®­ç»ƒæ ¼å¼ï¼Œå¹¶å¤„ç†éªŒè¯é›†å’Œæµ‹è¯•é›†ï¼š

SFTï¼ˆSupervised Fine-Tuningï¼‰æ ¼å¼ï¼›

DPOï¼ˆDirect Preference Optimizationï¼‰æ ¼å¼ï¼›

è½¬æ¢åçš„æ•°æ®å°†ä¿å­˜åœ¨ ./data/augmented_inst_data ç›®å½•ä¸­ï¼Œä¾›åç»­è®­ç»ƒä½¿ç”¨ã€‚

### ç¬¬äºŒæ­¥ï¼šæ¨¡å‹è®­ç»ƒ
è¿è¡Œè®­ç»ƒè„šæœ¬ï¼š

```bash
bash run_llama.sh
```
è¯¥è„šæœ¬åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š

SFTï¼ˆç›‘ç£å¼å¾®è°ƒï¼‰è®­ç»ƒ

DPOï¼ˆç›´æ¥åå¥½ä¼˜åŒ–ï¼‰è®­ç»ƒ

æœ€ç»ˆè®­ç»ƒå¥½çš„æ¨¡å‹å‚æ•°å°†ä¿å­˜åœ¨ä»¥ä¸‹ç›®å½•ï¼š

```bash
./checkpoints/sft_llama_dpo/
```

### ç¬¬ä¸‰æ­¥ï¼šæ¨¡å‹æ¨ç†
è¿è¡Œæ¨ç†è„šæœ¬ï¼š

```bash
bash run_test_llama.sh
````
è¯¥è„šæœ¬ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œç»“æœå°†è¾“å‡ºåˆ°ï¼š

```bash
./results/
```
ä½ å¯ä»¥åœ¨è¯¥ç›®å½•ä¸­æŸ¥çœ‹æ¨¡å‹ç”Ÿæˆçš„ç»“æœæ–‡æœ¬ã€‚

### ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜
```bash
.
AI_Text/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ augmented_data/
â”‚   â”‚   â””â”€â”€ augmented_train.json # æ•°æ®å¢å¼ºåçš„è®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ augmented_inst_data/
â”‚   â”‚   â”œâ”€â”€ dpo_train.json       # DPOè®­ç»ƒæ•°æ®
â”‚   â”‚   â”œâ”€â”€ inst_dev.json        # éªŒè¯é›†
â”‚   â”‚   â”œâ”€â”€ inst_test.json       # æµ‹è¯•é›†
â”‚   â”‚   â””â”€â”€ sft_train.json       # SFTè®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ dataset_info.json        
â”‚   â”œâ”€â”€ dev.json                 # åŸå§‹éªŒè¯é›†
â”‚   â”œâ”€â”€ test.json                # åŸå§‹æµ‹è¯•é›†
â”‚   â””â”€â”€ train.json               # åŸå§‹è®­ç»ƒé›†
â”‚
â”œâ”€â”€ data_process/
â”‚   â”œâ”€â”€ augment.py               # æ•°æ®å¢å¼ºè„šæœ¬
â”‚   â””â”€â”€ transfer.py              # æ•°æ®æ ¼å¼è½¬æ¢è„šæœ¬
â”‚
â”œâ”€â”€ src/
â”‚   â””â”€â”€ downloads.py             # æ¨¡å‹/æ•°æ®ä¸‹è½½è„šæœ¬ï¼ˆå¦‚æœ‰ä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt             # ç¯å¢ƒä¾èµ–æ–‡ä»¶
â”œâ”€â”€ run_data_process.sh          # æ•°æ®é¢„å¤„ç†å…¥å£è„šæœ¬
â”œâ”€â”€ run_llama.sh                 # æ¨¡å‹è®­ç»ƒè„šæœ¬ï¼ˆåŒ…å«SFTä¸DPOï¼‰
â””â”€â”€ run_test_llama.sh            # æµ‹è¯•æ¨ç†è„šæœ¬
```
### âš ï¸ æ³¨æ„äº‹é¡¹
å»ºè®®ä½¿ç”¨å…·å¤‡è‡³å°‘ 24GB æ˜¾å­˜çš„ GPUï¼›

æ•°æ®é¢„å¤„ç†å’Œè®­ç»ƒè¿‡ç¨‹å¯èƒ½å ç”¨è¾ƒå¤šç£ç›˜ç©ºé—´ï¼Œè¯·ç¡®ä¿ç£ç›˜å‰©ä½™å……è¶³ï¼›

è‹¥æ¨¡å‹è·¯å¾„æˆ–æ•°æ®è·¯å¾„å˜åŒ–ï¼Œè¯·å¯¹åº”æ›´æ–°è„šæœ¬å‚æ•°ã€‚

### å¦‚æœ‰é—®é¢˜æ¬¢è¿æäº¤ Issue æˆ–è”ç³»ç»´æŠ¤è€… ğŸ™Œ